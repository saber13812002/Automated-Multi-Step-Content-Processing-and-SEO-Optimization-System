<!-- 371eb6c2-0a16-41dd-a2d6-5965ebac018b 2de77c94-cbb7-47cb-8f26-0e5e3f9b0995 -->
# طرح کلی پیاده‌سازی

1. **بازنگری تشخیص زبان (`detectLang/detectLanguage.py`)**

- اطمینان از پشتیبانی اجرای تکی (`--audio-file`) و دسته‌ای (`--directory`).
- تولید خروجی JSON زمان‌بندی زبان برای هر فایل در پوشه خروجی مشخص.
- تنظیمات CLI برای مدل، دستگاه، و مسیر خروجی مستند شود.

2. **طراحی پایگاه‌داده و مرجع‌دهی**

- ایجاد جدول `audio_files` (شناسه، مسیر اصلی، طول، وضعیت پردازش).
- ایجاد جدول `language_segments` ارجاع‌دهنده به `audio_files.id` (زبان، بازه زمانی، متن، مسیر JSON).
- نگه داشتن جدول فعلی (در صورت وجود) و ایجاد کلید خارجی برای حفظ مرجع به ساختار قبلی.

3. **اسکریپت برش صوت و ذخیره‌سازی (`detectLang/split_and_store.py`)**

- خواندن JSONهای خروجی مرحله 1.
- برش فایل با `ffmpeg`, ذخیره تکه‌ها در پوشه تفکیک‌شده.
- درج رکوردها در `language_segments` و ثبت مرجع به جدول موجود (کلید خارجی).
- قابلیت اجرای تکی (فایل مشخص) یا همه گزارش‌های یک پوشه.

4. **اسکریپت خروجی جاب‌ها (`detectLang/export_jobs.py`)**

- استخراج رکوردهای `language_segments` بر اساس فیلتر فایل/زبان.
- خروجی JSONL/CSV برای مصرف سرویس زیرنویس‌ساز.
- گزینه اجرای تکی یا کل پوشه با الگو (`LIKE`).

5. **اسکریپت تجمیع زیرنویس‌ها (`detectLang/merge_srt.py`)**

- خواندن SRTهای هر تکه، تنظیم آفست براساس `start_time`.
- تولید SRT نهایی مرتب‌شده و شماره‌گذاری جدید.
- امکان اجرای تکی (یک فایل مرجع) و استفاده از مسیر پوشه برای بچ.

6. **مستندسازی (`detectLang/README.md`)**

- افزودن بخش «جریان کامل» شامل مراحل اجرا برای تست تک‌فایل و پردازش دسته‌ای.
- توضیح ساختار جداول جدید و ارتباط با جداول موجود.
- درج نمونه دستورات برای هر مرحله و پیش‌نیاز (`ffmpeg`).

### To-dos

- [ ] بازبینی CLI تشخیص زبان برای حالت تکی/بچ
- [ ] تعریف جداول audio_files و language_segments
- [ ] پیاده‌سازی برش صوت و درج دیتابیس
- [ ] خروجی JSONL/CSV برای جاب‌های زیرنویس
- [ ] تجمیع SRTها با آفست صحیح
- [ ] به‌روزرسانی README با راهنمای کامل