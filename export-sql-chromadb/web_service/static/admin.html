<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª - Export Jobs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-link {
            display: inline-block;
            margin-top: 15px;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .jobs-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .jobs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .jobs-header h2 {
            color: #333;
            font-size: 1.8rem;
        }

        .refresh-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .refresh-button:hover {
            transform: translateY(-2px);
        }

        .refresh-button:active {
            transform: translateY(0);
        }

        .jobs-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .jobs-table th,
        .jobs-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        .jobs-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }

        .jobs-table tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: #ffc107;
            color: #000;
        }

        .status-running {
            background: #2196F3;
            color: white;
        }

        .status-completed {
            background: #4CAF50;
            color: white;
        }

        .status-failed {
            background: #f44336;
            color: white;
        }

        .detail-button {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .detail-button:hover {
            background: #5568d3;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-button:hover {
            color: #333;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
        }

        .detail-value {
            color: #333;
        }

        .info-note {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #1976d2;
        }

        .admin-box {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .admin-box h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 15px;
        }

        .embedding-model-card {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            background: #fdfdfd;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .embedding-model-card.inactive {
            opacity: 0.6;
        }

        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .model-title {
            font-weight: 700;
            color: #333;
        }

        .model-collection {
            font-size: 0.85rem;
            color: #666;
        }

        .model-color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .model-color-picker input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
        }

        .model-meta {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.4;
        }

        .vote-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            background: #fafafa;
        }

        .vote-card strong {
            color: #333;
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .badge.like {
            background: #10B981;
        }

        .badge.dislike {
            background: #EF4444;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
        }

        .summary-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            background: #fff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .command-output {
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 15px;
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .copy-button:hover {
            background: #5568d3;
        }

        .collections-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }

        .collection-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collection-item:last-child {
            border-bottom: none;
        }

        .collection-name {
            font-weight: 600;
            color: #333;
        }

        .collection-count {
            color: #666;
            font-size: 0.9rem;
        }

        .test-result {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
            <p>ØªÙ†Ø¸ÛŒÙ…Ø§Øª ChromaDBØŒ Jobs Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒØ³ØªÙ…</p>
            <a href="/" class="nav-link">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø³ØªØ¬Ùˆ</a>
        </div>

        <!-- ChromaDB Settings Box -->
        <div class="admin-box">
            <h2>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ChromaDB</h2>
            
            <div class="form-group">
                <button class="refresh-button" onclick="testChromaConnection()">ğŸ” ØªØ³Øª Ø§ØªØµØ§Ù„</button>
                <button class="refresh-button" onclick="loadCollections()" style="margin-right: 10px;">ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ù„Ú©Ø´Ù†â€ŒÙ‡Ø§</button>
            </div>

            <div id="testResult"></div>
            <div id="collectionsList"></div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ± Export</h3>
            <form id="exportCommandForm" onsubmit="generateExportCommand(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="sqlPath">Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ SQL:</label>
                        <input type="text" id="sqlPath" value="book_pages.sql" required>
                    </div>
                    <div class="form-group">
                        <label for="collectionName">Ù†Ø§Ù… Ú©Ø§Ù„Ú©Ø´Ù†:</label>
                        <input type="text" id="collectionName" value="book_pages" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="embeddingProvider">Embedding Provider:</label>
                        <select id="embeddingProvider">
                            <option value="openai">openai</option>
                            <option value="none">none</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="embeddingModel">Embedding Model:</label>
                        <input type="text" id="embeddingModel" value="text-embedding-3-small">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="batchSize">Batch Size:</label>
                        <input type="number" id="batchSize" value="48" min="1">
                    </div>
                    <div class="form-group">
                        <label for="maxLength">Max Length:</label>
                        <input type="number" id="maxLength" value="200" min="1">
                    </div>
                    <div class="form-group">
                        <label for="contextLength">Context Length:</label>
                        <input type="number" id="contextLength" value="100" min="0">
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="resetCollection">
                        <label for="resetCollection">Reset Ú©Ø§Ù„Ú©Ø´Ù† Ù‚Ø¨Ù„ Ø§Ø² export</label>
                    </div>
                </div>
                <button type="submit" class="refresh-button">ğŸ”§ ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ± Export</button>
            </form>
            <div id="exportCommandOutput"></div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ± Uvicorn</h3>
            <form id="uvicornCommandForm" onsubmit="generateUvicornCommand(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="uvicornHost">Host:</label>
                        <input type="text" id="uvicornHost" value="0.0.0.0">
                    </div>
                    <div class="form-group">
                        <label for="uvicornPort">Port:</label>
                        <input type="number" id="uvicornPort" value="8080" min="1" max="65535">
                    </div>
                    <div class="form-group">
                        <label for="uvicornCollection">Collection Override (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <input type="text" id="uvicornCollection" placeholder="Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² .env">
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="uvicornReload" checked>
                        <label for="uvicornReload">Auto-reload (--reload)</label>
                    </div>
                </div>
                <button type="submit" class="refresh-button">ğŸš€ ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ± Uvicorn</button>
            </form>
            <div id="uvicornCommandOutput"></div>
        </div>

        <!-- Query Management Box -->
        <div class="admin-box">
            <h2>ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙˆØ§Ø¨Ù‚ Ø¬Ø³ØªØ¬Ùˆ</h2>
            
            <div class="form-group">
                <button class="refresh-button" onclick="loadQueries()">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
                <button class="refresh-button" onclick="loadQueryStats()" style="margin-right: 10px;">ğŸ“Š Ø¢Ù…Ø§Ø±</button>
            </div>

            <div id="queryStats" style="margin-bottom: 20px;"></div>

            <div class="form-row" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label for="queryStatusFilter">ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª:</label>
                    <select id="queryStatusFilter" onchange="loadQueries()">
                        <option value="">Ù‡Ù…Ù‡</option>
                        <option value="approved">ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                        <option value="rejected">Ø±Ø¯ Ø´Ø¯Ù‡</option>
                        <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="queryMinCount">Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ ØªÚ©Ø±Ø§Ø±:</label>
                    <input type="number" id="queryMinCount" value="0" min="0" onchange="loadQueries()">
                </div>
            </div>

            <div id="queriesLoading" class="loading" style="display: none;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
            <div id="queriesError" class="error" style="display: none;"></div>
            <div id="queriesList"></div>
        </div>

        <!-- Embedding Models Management -->
        <div class="admin-box">
            <h2>ğŸ§  Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯</h2>
            <p style="color:#666; margin-bottom:15px;">
                Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¢Ø®Ø±ÛŒÙ† Job Ù…ÙˆÙÙ‚ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„
                Ú©Ø±Ø¯Ù‡ Ùˆ Ø±Ù†Ú¯ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØµÙØ­Ù‡ Ø¬Ø³ØªØ¬Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†Ø¯ (Ø­Ø¯Ø§Ú©Ø«Ø± 10 Ù…Ø¯Ù„).
            </p>
            <div class="form-group">
                <button class="refresh-button" onclick="loadEmbeddingModels()">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§</button>
            </div>
            <div id="modelsLoading" class="loading" style="display:none;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§...</div>
            <div id="modelsError" class="error" style="display:none;"></div>
            <div id="modelsList"></div>
        </div>

        <!-- Votes monitoring -->
        <div class="admin-box">
            <h2>â¤ï¸ Ø¢Ù…Ø§Ø± Ø±Ø§ÛŒâ€ŒÙ‡Ø§</h2>
            <div class="form-group">
                <button class="refresh-button" onclick="loadVotes()">ğŸ”„ Ø±Ø§ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</button>
                <button class="refresh-button" onclick="loadVoteSummary()" style="margin-right:10px;">ğŸ“Š Ø®Ù„Ø§ØµÙ‡</button>
            </div>
            <div id="votesLoading" class="loading" style="display:none;">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø±Ø§ÛŒâ€ŒÙ‡Ø§...</div>
            <div id="votesError" class="error" style="display:none;"></div>
            <div id="votesList"></div>

            <h3 style="margin-top:25px; color:#333;">Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Query/Model</h3>
            <div id="voteSummaryLoading" class="loading" style="display:none;">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø®Ù„Ø§ØµÙ‡...</div>
            <div id="voteSummaryError" class="error" style="display:none;"></div>
            <div id="voteSummary"></div>
        </div>

        <!-- Auth Management Box -->
        <div class="admin-box">
            <h2>ğŸ” Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§</h2>
            
            <div class="form-group">
                <button class="refresh-button" onclick="loadUsers()">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</button>
                <button class="refresh-button" onclick="loadTokens()" style="margin-right: 10px;">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§</button>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
            <form id="createUserForm" onsubmit="createUser(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newUsername">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
                        <input type="text" id="newUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserEmail">Ø§ÛŒÙ…ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <input type="email" id="newUserEmail">
                    </div>
                </div>
                <button type="submit" class="refresh-button">â• Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±</button>
            </form>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù† Ø¬Ø¯ÛŒØ¯</h3>
            <form id="createTokenForm" onsubmit="createToken(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="tokenUserId">Ú©Ø§Ø±Ø¨Ø±:</label>
                        <select id="tokenUserId" required>
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tokenName">Ù†Ø§Ù… ØªÙˆÚ©Ù†:</label>
                        <input type="text" id="tokenName" required placeholder="Ù…Ø«Ù„Ø§Ù‹: Production API">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="tokenRateLimit">Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø¯Ø± Ø±ÙˆØ²:</label>
                        <input type="number" id="tokenRateLimit" value="1000" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="tokenExpiresAt">ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <input type="datetime-local" id="tokenExpiresAt">
                    </div>
                </div>
                <button type="submit" class="refresh-button">ğŸ”‘ Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù†</button>
            </form>
            <div id="tokenOutput"></div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
            <div id="usersList"></div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">Ù„ÛŒØ³Øª ØªÙˆÚ©Ù†â€ŒÙ‡Ø§</h3>
            <div id="tokensList"></div>
        </div>

        <!-- Jobs Box -->
        <div class="jobs-container">
            <div class="jobs-header">
                <h2>Ù„ÛŒØ³Øª Jobs</h2>
                <button class="refresh-button" onclick="loadJobs()">ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
            </div>

            <div id="loading" class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
            <div id="error" class="error" style="display: none;"></div>

            <table class="jobs-table" id="jobsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        <th>Collection</th>
                        <th>Ø´Ø±ÙˆØ¹</th>
                        <th>Ù…Ø¯Øª Ø²Ù…Ø§Ù†</th>
                        <th>Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§</th>
                        <th>Ú©ØªØ§Ø¨â€ŒÙ‡Ø§</th>
                        <th>Ù‚Ø·Ø¹Ø§Øª</th>
                        <th>Ù…Ø³ØªÙ†Ø¯Ø§Øª</th>
                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody id="jobsTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for job details -->
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø¬Ø²Ø¦ÛŒØ§Øª Job</h2>
                <button class="close-button" onclick="closeModal()">&times;</button>
            </div>
            <div id="jobDetails"></div>
        </div>
    </div>

    <script>
        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleString('fa-IR');
        }

        function formatDuration(seconds) {
            if (!seconds) return '-';
            if (seconds < 60) return `${Math.round(seconds)} Ø«Ø§Ù†ÛŒÙ‡`;
            if (seconds < 3600) return `${Math.round(seconds / 60)} Ø¯Ù‚ÛŒÙ‚Ù‡`;
            return `${Math.round(seconds / 3600)} Ø³Ø§Ø¹Øª`;
        }

        function formatNumber(num) {
            if (num === null || num === undefined) return '-';
            return num.toLocaleString('fa-IR');
        }

        function getStatusClass(status) {
            const statusMap = {
                'pending': 'status-pending',
                'running': 'status-running',
                'completed': 'status-completed',
                'failed': 'status-failed'
            };
            return statusMap[status] || 'status-pending';
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
                'running': 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§',
                'completed': 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡',
                'failed': 'Ù†Ø§Ù…ÙˆÙÙ‚'
            };
            return statusMap[status] || status;
        }

        async function loadJobs() {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const tableEl = document.getElementById('jobsTable');
            const tableBodyEl = document.getElementById('jobsTableBody');

            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            tableEl.style.display = 'none';

            try {
                const response = await fetch('/admin/jobs', {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                tableBodyEl.innerHTML = '';

                if (data.jobs && data.jobs.length > 0) {
                    data.jobs.forEach(job => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${job.id}</td>
                            <td><span class="status-badge ${getStatusClass(job.status)}">${getStatusText(job.status)}</span></td>
                            <td>${escapeHtml(job.collection)}</td>
                            <td>${formatDate(job.started_at)}</td>
                            <td>${formatDuration(job.duration_seconds)}</td>
                            <td>${formatNumber(job.total_records)}</td>
                            <td>${formatNumber(job.total_books)}</td>
                            <td>${formatNumber(job.total_segments)}</td>
                            <td>${formatNumber(job.total_documents_in_collection)}</td>
                            <td><button class="detail-button" onclick="showJobDetails(${job.id})">Ø¬Ø²Ø¦ÛŒØ§Øª</button></td>
                        `;
                        tableBodyEl.appendChild(row);
                    });
                    tableEl.style.display = 'table';
                } else {
                    tableBodyEl.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: #666;">Ù‡ÛŒÚ† jobÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
                    tableEl.style.display = 'table';
                }
            } catch (error) {
                errorEl.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ jobs: ${error.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        async function showJobDetails(jobId) {
            const modal = document.getElementById('jobModal');
            const detailsEl = document.getElementById('jobDetails');

            detailsEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';
            modal.style.display = 'block';

            try {
                const response = await fetch(`/admin/jobs/${jobId}`, {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const job = await response.json();

                let commandArgs = '';
                if (job.command_line_args) {
                    try {
                        const args = JSON.parse(job.command_line_args);
                        commandArgs = Object.entries(args)
                            .map(([key, value]) => `<div class="detail-row"><span class="detail-label">${escapeHtml(key)}:</span><span class="detail-value">${escapeHtml(String(value))}</span></div>`)
                            .join('');
                    } catch (e) {
                        commandArgs = `<div class="detail-value">${escapeHtml(job.command_line_args)}</div>`;
                    }
                }

                detailsEl.innerHTML = `
                    <div class="detail-section">
                        <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ</h3>
                        <div class="detail-row">
                            <span class="detail-label">ID:</span>
                            <span class="detail-value">${job.id}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ÙˆØ¶Ø¹ÛŒØª:</span>
                            <span class="detail-value"><span class="status-badge ${getStatusClass(job.status)}">${getStatusText(job.status)}</span></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Collection:</span>
                            <span class="detail-value">${escapeHtml(job.collection)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ø´Ø±ÙˆØ¹:</span>
                            <span class="detail-value">${formatDate(job.started_at)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ù¾Ø§ÛŒØ§Ù†:</span>
                            <span class="detail-value">${formatDate(job.completed_at)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ù…Ø¯Øª Ø²Ù…Ø§Ù†:</span>
                            <span class="detail-value">${formatDuration(job.duration_seconds)}</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>Ø¢Ù…Ø§Ø±</h3>
                        <div class="detail-row">
                            <span class="detail-label">Ú©Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§:</span>
                            <span class="detail-value">${formatNumber(job.total_records)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ú©Ù„ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§:</span>
                            <span class="detail-value">${formatNumber(job.total_books)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ú©Ù„ Ù‚Ø·Ø¹Ø§Øª:</span>
                            <span class="detail-value">${formatNumber(job.total_segments)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ú©Ù„ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¯Ø± Ú©Ø§Ù„Ú©Ø´Ù†:</span>
                            <span class="detail-value">${formatNumber(job.total_documents_in_collection)}</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Export</h3>
                        <div class="detail-row">
                            <span class="detail-label">SQL Path:</span>
                            <span class="detail-value">${escapeHtml(job.sql_path)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Batch Size:</span>
                            <span class="detail-value">${job.batch_size}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Max Length:</span>
                            <span class="detail-value">${job.max_length}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Context Length:</span>
                            <span class="detail-value">${job.context_length}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Host:</span>
                            <span class="detail-value">${escapeHtml(job.host)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Port:</span>
                            <span class="detail-value">${job.port}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">SSL:</span>
                            <span class="detail-value">${job.ssl ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Embedding Provider:</span>
                            <span class="detail-value">${escapeHtml(job.embedding_provider)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Embedding Model:</span>
                            <span class="detail-value">${escapeHtml(job.embedding_model)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Reset:</span>
                            <span class="detail-value">${job.reset ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}</span>
                        </div>
                    </div>

                    ${job.error_message ? `
                    <div class="detail-section">
                        <h3>Ø®Ø·Ø§</h3>
                        <div class="error">${escapeHtml(job.error_message)}</div>
                    </div>
                    ` : ''}

                    ${commandArgs ? `
                    <div class="detail-section">
                        <h3>Command Line Arguments</h3>
                        ${commandArgs}
                    </div>
                    ` : ''}
                `;
            } catch (error) {
                detailsEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª: ${escapeHtml(error.message)}</div>`;
            }
        }

        function closeModal() {
            const modal = document.getElementById('jobModal');
            modal.style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('jobModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        async function testChromaConnection() {
            const resultEl = document.getElementById('testResult');
            resultEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§ØªØµØ§Ù„...</div>';

            try {
                const response = await fetch('/admin/chroma/test-connection', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    let collectionsHtml = '';
                    if (data.collections && data.collections.length > 0) {
                        collectionsHtml = `<p><strong>Ú©Ø§Ù„Ú©Ø´Ù†â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯:</strong> ${data.collections.join(', ')}</p>`;
                    }
                    resultEl.innerHTML = `
                        <div class="test-result success">
                            <strong>âœ… ${escapeHtml(data.message)}</strong>
                            ${collectionsHtml}
                        </div>
                    `;
                } else {
                    resultEl.innerHTML = `
                        <div class="test-result error">
                            <strong>âŒ ${escapeHtml(data.message)}</strong>
                        </div>
                    `;
                }
            } catch (error) {
                resultEl.innerHTML = `
                    <div class="test-result error">
                        <strong>âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Ø§ØªØµØ§Ù„: ${escapeHtml(error.message)}</strong>
                    </div>
                `;
            }
        }

        async function loadCollections() {
            const listEl = document.getElementById('collectionsList');
            listEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';

            try {
                const response = await fetch('/admin/chroma/collections', {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.collections && data.collections.length > 0) {
                    let html = '<div class="collections-list">';
                    data.collections.forEach(col => {
                        html += `
                            <div class="collection-item">
                                <span class="collection-name">${escapeHtml(col.name)}</span>
                                <span class="collection-count">${col.count !== null ? formatNumber(col.count) + ' Ù…Ø³ØªÙ†Ø¯' : 'Ù†Ø§Ù…Ø´Ø®Øµ'}</span>
                            </div>
                        `;
                    });
                    html += '</div>';
                    listEl.innerHTML = html;
                } else {
                    listEl.innerHTML = '<p style="color: #666; padding: 15px;">Ù‡ÛŒÚ† Ú©Ø§Ù„Ú©Ø´Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
                }
            } catch (error) {
                listEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù„Ú©Ø´Ù†â€ŒÙ‡Ø§: ${escapeHtml(error.message)}</div>`;
            }
        }

        async function generateExportCommand(event) {
            event.preventDefault();
            const outputEl = document.getElementById('exportCommandOutput');
            outputEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ±...</div>';

            try {
                const requestData = {
                    sql_path: document.getElementById('sqlPath').value,
                    collection: document.getElementById('collectionName').value,
                    embedding_provider: document.getElementById('embeddingProvider').value,
                    embedding_model: document.getElementById('embeddingModel').value,
                    reset: document.getElementById('resetCollection').checked,
                    batch_size: parseInt(document.getElementById('batchSize').value),
                    max_length: parseInt(document.getElementById('maxLength').value),
                    context_length: parseInt(document.getElementById('contextLength').value),
                };

                const response = await fetch('/admin/chroma/generate-export-command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'Accept': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                outputEl.innerHTML = `
                    <div class="command-output">
                        <button class="copy-button" onclick="copyToClipboard('${escapeHtml(data.command).replace(/'/g, "\\'")}')">ğŸ“‹ Ú©Ù¾ÛŒ</button>
                        <div style="margin-top: 30px;">
                            <strong>${escapeHtml(data.description)}</strong>
                            <pre style="margin-top: 10px; white-space: pre-wrap; word-break: break-all;">${escapeHtml(data.command)}</pre>
                        </div>
                    </div>
                `;
            } catch (error) {
                outputEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ±: ${escapeHtml(error.message)}</div>`;
            }
        }

        async function generateUvicornCommand(event) {
            event.preventDefault();
            const outputEl = document.getElementById('uvicornCommandOutput');
            outputEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ±...</div>';

            try {
                const requestData = {
                    host: document.getElementById('uvicornHost').value,
                    port: parseInt(document.getElementById('uvicornPort').value),
                    reload: document.getElementById('uvicornReload').checked,
                    collection: document.getElementById('uvicornCollection').value || null,
                };

                const response = await fetch('/admin/chroma/generate-uvicorn-command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'Accept': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let envVarsHtml = '';
                if (data.env_vars) {
                    envVarsHtml = '<div style="margin-top: 15px;"><strong>Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ:</strong><pre style="margin-top: 5px;">';
                    for (const [key, value] of Object.entries(data.env_vars)) {
                        envVarsHtml += `${key}=${value}\n`;
                    }
                    envVarsHtml += '</pre></div>';
                }

                outputEl.innerHTML = `
                    <div class="command-output">
                        <button class="copy-button" onclick="copyToClipboard('${escapeHtml(data.command).replace(/'/g, "\\'")}')">ğŸ“‹ Ú©Ù¾ÛŒ</button>
                        <div style="margin-top: 30px;">
                            <strong>${escapeHtml(data.description)}</strong>
                            <pre style="margin-top: 10px; white-space: pre-wrap;">${escapeHtml(data.command)}</pre>
                            ${envVarsHtml}
                        </div>
                    </div>
                `;
            } catch (error) {
                outputEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ø¯Ø³ØªÙˆØ±: ${escapeHtml(error.message)}</div>`;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Ø¯Ø³ØªÙˆØ± Ú©Ù¾ÛŒ Ø´Ø¯!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        async function loadQueries() {
            const loadingEl = document.getElementById('queriesLoading');
            const errorEl = document.getElementById('queriesError');
            const listEl = document.getElementById('queriesList');

            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';

            try {
                const status = document.getElementById('queryStatusFilter').value;
                const minCount = parseInt(document.getElementById('queryMinCount').value) || 0;
                
                let url = `/admin/queries?min_count=${minCount}&limit=100`;
                if (status) {
                    url += `&status=${status}`;
                }

                const response = await fetch(url, {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.queries && data.queries.length > 0) {
                    let html = '<div class="collections-list">';
                    data.queries.forEach(q => {
                        const statusClass = q.status === 'approved' ? 'status-completed' : 
                                           q.status === 'rejected' ? 'status-failed' : 'status-pending';
                        const statusText = q.status === 'approved' ? 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡' : 
                                          q.status === 'rejected' ? 'Ø±Ø¯ Ø´Ø¯Ù‡' : 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                        
                        html += `
                            <div class="collection-item">
                                <div style="flex: 1;">
                                    <div class="collection-name">${escapeHtml(q.query)}</div>
                                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                        ØªØ¹Ø¯Ø§Ø¯ ØªÚ©Ø±Ø§Ø±: ${formatNumber(q.search_count)} | 
                                        Ø¢Ø®Ø±ÛŒÙ† Ø¬Ø³ØªØ¬Ùˆ: ${q.last_searched_at ? formatDate(q.last_searched_at) : '-'}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 5px; align-items: center;">
                                    <span class="status-badge ${statusClass}">${statusText}</span>
                                    ${q.status !== 'approved' ? `<button class="detail-button" onclick="approveQuery('${encodeURIComponent(q.query)}')">âœ… ØªØ§ÛŒÛŒØ¯</button>` : ''}
                                    ${q.status !== 'rejected' ? `<button class="detail-button" onclick="rejectQuery('${encodeURIComponent(q.query)}')" style="background: #dc3545;">âŒ Ø±Ø¯</button>` : ''}
                                    <button class="detail-button" onclick="deleteQuery('${encodeURIComponent(q.query)}')" style="background: #6c757d;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    listEl.innerHTML = html;
                } else {
                    listEl.innerHTML = '<p style="color: #666; padding: 15px;">Ù‡ÛŒÚ† queryÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
                }
            } catch (error) {
                errorEl.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ queries: ${escapeHtml(error.message)}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        async function loadEmbeddingModels() {
            const loadingEl = document.getElementById('modelsLoading');
            const errorEl = document.getElementById('modelsError');
            const listEl = document.getElementById('modelsList');
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            listEl.innerHTML = '';

            try {
                const response = await fetch('/admin/models?limit=10', {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                renderEmbeddingModels(data.models || []);
            } catch (error) {
                errorEl.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§: ${error.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function renderEmbeddingModels(models) {
            const listEl = document.getElementById('modelsList');
            if (!models || models.length === 0) {
                listEl.innerHTML = '<p style="color:#666;">Ù‡ÛŒÚ† Ù…Ø¯Ù„ ÙØ¹Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>';
                return;
            }

            let html = '<div class="models-grid">';
            models.forEach(model => {
                const color = model.color && /^#/.test(model.color) ? model.color : '#3B82F6';
                html += `
                    <div class="embedding-model-card ${model.is_active ? '' : 'inactive'}" style="border-top:4px solid ${color};">
                        <div class="model-header">
                            <div>
                                <div class="model-title">${escapeHtml(model.embedding_model)}</div>
                                <div class="model-collection">${escapeHtml(model.collection)}</div>
                            </div>
                            <label class="checkbox-group" style="margin:0;">
                                <input type="checkbox" ${model.is_active ? 'checked' : ''} onchange="toggleEmbeddingModel(${model.id}, this.checked)">
                                <span>${model.is_active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}</span>
                            </label>
                        </div>
                        <div class="model-meta">
                            <div>Provider: ${escapeHtml(model.embedding_provider)}</div>
                            <div>Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${model.completed_at ? formatDate(model.completed_at) : '-'}</div>
                        </div>
                        <div class="model-color-picker">
                            <span>Ø±Ù†Ú¯ Ù†Ù…Ø§ÛŒØ´:</span>
                            <input type="color" value="${color}" onchange="updateEmbeddingModelColor(${model.id}, this.value)">
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            listEl.innerHTML = html;
        }

        async function toggleEmbeddingModel(modelId, isActive) {
            try {
                const response = await fetch(`/admin/models/${modelId}/toggle`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'Accept': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify({ is_active: isActive })
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                await response.json();
                loadEmbeddingModels();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù…Ø¯Ù„: ${error.message}`);
            }
        }

        async function updateEmbeddingModelColor(modelId, color) {
            try {
                const response = await fetch(`/admin/models/${modelId}/color`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'Accept': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify({ color })
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                await response.json();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ù…Ø¯Ù„: ${error.message}`);
                loadEmbeddingModels();
            }
        }

        async function loadVotes() {
            const loadingEl = document.getElementById('votesLoading');
            const errorEl = document.getElementById('votesError');
            const listEl = document.getElementById('votesList');
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            listEl.innerHTML = '';

            try {
                const response = await fetch('/admin/search/votes?limit=50', {
                    headers: { 'Accept': 'application/json; charset=utf-8' }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                renderVotes(data.votes || []);
            } catch (error) {
                errorEl.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø±Ø§ÛŒâ€ŒÙ‡Ø§: ${error.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function renderVotes(votes) {
            const listEl = document.getElementById('votesList');
            if (!votes || votes.length === 0) {
                listEl.innerHTML = '<p style="color:#666;">Ù‡Ù†ÙˆØ² Ø±Ø§ÛŒÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
                return;
            }

            let html = '';
            votes.forEach(vote => {
                const badgeClass = vote.vote_type === 'like' ? 'badge like' : 'badge dislike';
                const badgeText = vote.vote_type === 'like' ? 'Ù„Ø§ÛŒÚ©' : 'Ø¯ÛŒØ³Ù„Ø§ÛŒÚ©';
                html += `
                    <div class="vote-card">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <strong>${escapeHtml(vote.query)}</strong>
                            <span class="${badgeClass}">${badgeText}</span>
                        </div>
                        <div style="font-size:0.85rem; color:#555; margin-top:8px;">
                            Ù…Ø¯Ù„: ${vote.embedding_model ? escapeHtml(vote.embedding_model) : 'Ø¹Ù…ÙˆÙ…ÛŒ'} | 
                            Ù…Ù‡Ù…Ø§Ù†: ${escapeHtml(vote.guest_user_id)} | 
                            Ø²Ù…Ø§Ù†: ${vote.created_at ? formatDate(vote.created_at) : '-'}
                        </div>
                    </div>
                `;
            });
            listEl.innerHTML = html;
        }

        async function loadVoteSummary() {
            const loadingEl = document.getElementById('voteSummaryLoading');
            const errorEl = document.getElementById('voteSummaryError');
            const summaryEl = document.getElementById('voteSummary');
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            summaryEl.innerHTML = '';

            try {
                const response = await fetch('/admin/search/votes/summary?limit=50', {
                    headers: { 'Accept': 'application/json; charset=utf-8' }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                renderVoteSummary(data.items || []);
            } catch (error) {
                errorEl.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø®Ù„Ø§ØµÙ‡ Ø±Ø§ÛŒâ€ŒÙ‡Ø§: ${error.message}`;
                errorEl.style.display = 'block';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function renderVoteSummary(items) {
            const summaryEl = document.getElementById('voteSummary');
            if (!items || items.length === 0) {
                summaryEl.innerHTML = '<p style="color:#666;">Ø®Ù„Ø§ØµÙ‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</p>';
                return;
            }

            let html = '<div class="summary-grid">';
            items.forEach(item => {
                html += `
                    <div class="summary-card">
                        <div style="font-weight:600; margin-bottom:5px;">${escapeHtml(item.query)}</div>
                        <div style="font-size:0.85rem; color:#555;">
                            Ù…Ø¯Ù„: ${item.embedding_model ? escapeHtml(item.embedding_model) : 'Ø¹Ù…ÙˆÙ…ÛŒ'}
                        </div>
                        <div style="margin-top:8px;">
                            <span class="badge like">ğŸ‘ ${item.likes}</span>
                            <span class="badge dislike" style="margin-right:5px;">ğŸ‘ ${item.dislikes}</span>
                        </div>
                        <div style="font-size:0.8rem; color:#777; margin-top:6px;">
                            Ø¢Ø®Ø±ÛŒÙ† Ø±Ø§ÛŒ: ${item.last_vote_at ? formatDate(item.last_vote_at) : '-'}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            summaryEl.innerHTML = html;
        }

        async function loadQueryStats() {
            const statsEl = document.getElementById('queryStats');
            statsEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';

            try {
                const response = await fetch('/admin/queries/stats', {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const stats = await response.json();
                statsEl.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        <div><strong>Ú©Ù„:</strong> ${formatNumber(stats.total)}</div>
                        <div><strong>ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡:</strong> <span style="color: #28a745;">${formatNumber(stats.approved)}</span></div>
                        <div><strong>Ø±Ø¯ Ø´Ø¯Ù‡:</strong> <span style="color: #dc3545;">${formatNumber(stats.rejected)}</span></div>
                        <div><strong>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±:</strong> <span style="color: #ffc107;">${formatNumber(stats.pending)}</span></div>
                        <div><strong>Ú©Ù„ Ø¬Ø³ØªØ¬ÙˆÙ‡Ø§:</strong> ${formatNumber(stats.total_searches)}</div>
                    </div>
                `;
            } catch (error) {
                statsEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±: ${escapeHtml(error.message)}</div>`;
            }
        }

        async function approveQuery(query) {
            try {
                const response = await fetch(`/admin/queries/${encodeURIComponent(query)}/approve`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                alert('Query ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!');
                loadQueries();
                loadQueryStats();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± ØªØ§ÛŒÛŒØ¯ query: ${error.message}`);
            }
        }

        async function rejectQuery(query) {
            try {
                const response = await fetch(`/admin/queries/${encodeURIComponent(query)}/reject`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                alert('Query Ø±Ø¯ Ø´Ø¯!');
                loadQueries();
                loadQueryStats();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± Ø±Ø¯ query: ${error.message}`);
            }
        }

        async function deleteQuery(query) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† query Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/admin/queries/${encodeURIComponent(query)}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                alert('Query Ø­Ø°Ù Ø´Ø¯!');
                loadQueries();
                loadQueryStats();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù query: ${error.message}`);
            }
        }

        async function loadUsers() {
            const listEl = document.getElementById('usersList');
            listEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';

            try {
                const response = await fetch('/admin/auth/users', {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Populate user select for token creation
                const userSelect = document.getElementById('tokenUserId');
                userSelect.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±...</option>';
                data.users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.username}${user.email ? ` (${user.email})` : ''}`;
                    userSelect.appendChild(option);
                });

                if (data.users && data.users.length > 0) {
                    let html = '<div class="collections-list">';
                    data.users.forEach(user => {
                        html += `
                            <div class="collection-item">
                                <div style="flex: 1;">
                                    <div class="collection-name">${escapeHtml(user.username)}</div>
                                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                        ${user.email ? `Ø§ÛŒÙ…ÛŒÙ„: ${escapeHtml(user.email)} | ` : ''}
                                        ØªÙˆÚ©Ù†â€ŒÙ‡Ø§: ${user.token_count || 0} | 
                                        Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡: ${formatDate(user.created_at)}
                                    </div>
                                </div>
                                <div>
                                    <span class="status-badge ${user.is_active ? 'status-completed' : 'status-failed'}">
                                        ${user.is_active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                                    </span>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    listEl.innerHTML = html;
                } else {
                    listEl.innerHTML = '<p style="color: #666; padding: 15px;">Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
                }
            } catch (error) {
                listEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ${escapeHtml(error.message)}</div>`;
            }
        }

        async function loadTokens() {
            const listEl = document.getElementById('tokensList');
            listEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';

            try {
                const response = await fetch('/admin/auth/tokens', {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.tokens && data.tokens.length > 0) {
                    let html = '<div class="collections-list">';
                    data.tokens.forEach(token => {
                        const usagePercent = token.usage_today ? (token.usage_today / token.rate_limit_per_day * 100) : 0;
                        html += `
                            <div class="collection-item">
                                <div style="flex: 1;">
                                    <div class="collection-name">${escapeHtml(token.name)}</div>
                                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                        Ú©Ø§Ø±Ø¨Ø±: ${escapeHtml(token.username)} | 
                                        Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²: ${formatNumber(token.usage_today || 0)} / ${formatNumber(token.rate_limit_per_day)} 
                                        (${usagePercent.toFixed(1)}%) | 
                                        ${token.expires_at ? `Ø§Ù†Ù‚Ø¶Ø§: ${formatDate(token.expires_at)} | ` : ''}
                                        ${token.last_used_at ? `Ø¢Ø®Ø±ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡: ${formatDate(token.last_used_at)}` : 'Ù‡Ø±Ú¯Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡'}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 5px; align-items: center;">
                                    <span class="status-badge ${token.is_active ? 'status-completed' : 'status-failed'}">
                                        ${token.is_active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                                    </span>
                                    ${token.is_active ? `<button class="detail-button" onclick="revokeToken(${token.id})" style="background: #dc3545;">ğŸš« ØºÛŒØ±ÙØ¹Ø§Ù„</button>` : ''}
                                    <button class="detail-button" onclick="showTokenUsage(${token.id})">ğŸ“Š Ø¢Ù…Ø§Ø±</button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    listEl.innerHTML = html;
                } else {
                    listEl.innerHTML = '<p style="color: #666; padding: 15px;">Ù‡ÛŒÚ† ØªÙˆÚ©Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
                }
            } catch (error) {
                listEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§: ${escapeHtml(error.message)}</div>`;
            }
        }

        async function createUser(event) {
            event.preventDefault();
            const username = document.getElementById('newUsername').value;
            const email = document.getElementById('newUserEmail').value;

            try {
                const response = await fetch('/admin/auth/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'Accept': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email || null
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || `HTTP error! status: ${response.status}`);
                }

                alert('Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!');
                document.getElementById('createUserForm').reset();
                loadUsers();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±: ${error.message}`);
            }
        }

        async function createToken(event) {
            event.preventDefault();
            const outputEl = document.getElementById('tokenOutput');
            outputEl.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù†...</div>';

            const userId = parseInt(document.getElementById('tokenUserId').value);
            const name = document.getElementById('tokenName').value;
            const rateLimit = parseInt(document.getElementById('tokenRateLimit').value);
            const expiresAt = document.getElementById('tokenExpiresAt').value;

            try {
                const requestData = {
                    user_id: userId,
                    name: name,
                    rate_limit_per_day: rateLimit,
                };

                if (expiresAt) {
                    requestData.expires_at = new Date(expiresAt).toISOString();
                }

                const response = await fetch('/admin/auth/tokens', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'Accept': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                outputEl.innerHTML = `
                    <div class="command-output">
                        <button class="copy-button" onclick="copyToClipboard('${escapeHtml(data.token).replace(/'/g, "\\'")}')">ğŸ“‹ Ú©Ù¾ÛŒ ØªÙˆÚ©Ù†</button>
                        <div style="margin-top: 30px;">
                            <strong>âœ… ØªÙˆÚ©Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!</strong>
                            <p style="margin-top: 10px; color: #dc3545; font-weight: bold;">
                                âš ï¸ Ø§ÛŒÙ† ØªÙˆÚ©Ù† ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯!
                            </p>
                            <div style="margin-top: 15px;">
                                <strong>ØªÙˆÚ©Ù†:</strong>
                                <pre style="margin-top: 5px; white-space: pre-wrap; word-break: break-all; background: #f0f0f0; padding: 10px; border-radius: 5px;">${escapeHtml(data.token)}</pre>
                            </div>
                            <div style="margin-top: 15px;">
                                <strong>Ø§Ø·Ù„Ø§Ø¹Ø§Øª:</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Ù†Ø§Ù…: ${escapeHtml(data.name)}</li>
                                    <li>Ú©Ø§Ø±Ø¨Ø±: ${escapeHtml(data.username)}</li>
                                    <li>Ø­Ø¯ Ù…Ø¬Ø§Ø²: ${formatNumber(data.rate_limit_per_day)} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø±ÙˆØ²</li>
                                    ${data.expires_at ? `<li>Ø§Ù†Ù‚Ø¶Ø§: ${formatDate(data.expires_at)}</li>` : '<li>Ø¨Ø¯ÙˆÙ† Ø§Ù†Ù‚Ø¶Ø§</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('createTokenForm').reset();
                loadTokens();
            } catch (error) {
                outputEl.innerHTML = `<div class="error">Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù†: ${escapeHtml(error.message)}</div>`;
            }
        }

        async function revokeToken(tokenId) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† ØªÙˆÚ©Ù† Ø±Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/admin/auth/tokens/${tokenId}`, {
                    method: 'DELETE',
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                alert('ØªÙˆÚ©Ù† ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯!');
                loadTokens();
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù†: ${error.message}`);
            }
        }

        async function showTokenUsage(tokenId) {
            try {
                const response = await fetch(`/admin/auth/tokens/${tokenId}/usage`, {
                    headers: {
                        'Accept': 'application/json; charset=utf-8'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const usage = await response.json();
                const usagePercent = (usage.usage_today / usage.rate_limit * 100).toFixed(1);
                alert(
                    `ğŸ“Š Ø¢Ù…Ø§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ ØªÙˆÚ©Ù† #${tokenId}\n\n` +
                    `Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²: ${formatNumber(usage.usage_today)} / ${formatNumber(usage.rate_limit)}\n` +
                    `Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${formatNumber(usage.remaining)}\n` +
                    `Ø¯Ø±ØµØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡: ${usagePercent}%\n` +
                    `Ø±ÛŒØ³Øª Ø¯Ø±: ${formatDate(usage.reset_at)}`
                );
            } catch (error) {
                alert(`Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±: ${error.message}`);
            }
        }

        // Load jobs on page load
        loadJobs();
        loadQueryStats();
        loadUsers();
        loadTokens();
        loadEmbeddingModels();
        loadVotes();
        loadVoteSummary();
    </script>
</body>
</html>

