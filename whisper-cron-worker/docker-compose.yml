version: '3.8'

services:
  app:
    build: .
    container_name: whisper-cron-worker-app
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    ports:
      - "${API_PORT:-3001}:3001"
    volumes:
      - ./media/input:/media/input:ro
      - ./media/output:/media/output:rw
      - whisper_model_cache:/root/.cache/whisper
      - cron_config:/app/config
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - API_PORT=${API_PORT:-3001}
      - CRON_ENABLED=${CRON_ENABLED:-true}
      - CRON_SCHEDULE=${CRON_SCHEDULE:-0 * * * *}
      - INPUT_DIR=${INPUT_DIR:-/media/input}
      - OUTPUT_DIR=${OUTPUT_DIR:-/media/output}
      - REPORT_WEBHOOK_URL=${REPORT_WEBHOOK_URL:-}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
      - WHISPER_MODEL=${WHISPER_MODEL:-large}
      - WHISPER_LANGUAGE=${WHISPER_LANGUAGE:-ar}
    networks:
      - whisper_network

volumes:
  whisper_model_cache:
    driver: local
  cron_config:
    driver: local

networks:
  whisper_network:
    driver: bridge

